<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë¡œê·¸ì¸ - OURAPP</title>
    <link rel="icon" type="image/png" href="rabbit-icon.png">
    <link rel="stylesheet" href="login.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
</head>
<body>
    <div class="login-container initials-container">
        <img src="rabbit-icon.png" alt="ê·€ì—¬ìš´ í† ë¼ ì•„ì´ì½˜" class="login-rabbit-icon">
        <h1>ìš°ë¦¬ë§Œì˜ ê³µê°„ì— ì˜¤ì‹ ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</h1>
        <p>ì‚¬ìš©í•  ì´ë‹ˆì…œì„ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
        <div class="initial-options">
            <button class="initial-option" data-name="J.W">J.W</button>
            <button class="initial-option" data-name="H.N">H.N</button>
            <button class="initial-option" data-name="Guest">Guest</button>
        </div>
    </div>
    <script>
        // Firebase Config (from index.html)
        const firebaseConfig = {
            apiKey: "AIzaSyD0GVrK55GdzCeUNzEp2suL861qoFURpDo",
            authDomain: "memo-app-backend-24bb4.firebaseapp.com",
            projectId: "memo-app-backend-24bb4",
            storageBucket: "memo-app-backend-24bb4.firebasestorage.app",
            messagingSenderId: "848227443507",
            appId: "1:848227443507:web:be5390301f33a52667d446",
            databaseURL: "https://memo-app-backend-24bb4-default-rtdb.asia-southeast1.firebasedatabase.app"
        };
        if (firebase.apps.length === 0) {
            firebase.initializeApp(firebaseConfig);
        }

        document.querySelectorAll('.initial-option').forEach(btn => {
            btn.onclick = () => {
                const name = btn.dataset.name;
                if (name === 'Guest') {
                    // ìµëª… ì¸ì¦ í›„ DBì— myName: 'Guest' ì €ì¥
                    firebase.auth().signInAnonymously().then(userCredential => {
                        const user = userCredential.user;
                        firebase.database().ref('userInitials/' + user.uid).set({ myName: 'Guest' }).then(() => {
                            localStorage.setItem('myName', 'Guest');
                            window.location.href = 'index.html';
                        });
                    }).catch(error => {
                        alert('ìµëª… ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + error.message);
                    });
                } else {
                    window.location.href = `login.html?user=${name}`;
                }
            };
        });

        // Firebase ì¸ì¦ ìƒíƒœ ë³€í™” ê°ì§€
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                // ë¡œê·¸ì¸ëœ ê²½ìš°, DBì—ì„œ myNameì„ ê°€ì ¸ì™€ localStorageì™€ ë™ê¸°í™”
                firebase.database().ref('userInitials/' + user.uid).once('value').then(snapshot => {
                    const myName = snapshot.val() && snapshot.val().myName;
                    if (myName) {
                        localStorage.setItem('myName', myName);
                        // í™˜ì˜ ë©”ì‹œì§€ ë“± ëª¨ë“  myName ì‚¬ìš©ì²˜ì—ì„œ ì´ ê°’ì„ ì‚¬ìš©
                        const userWelcome = document.getElementById('user-welcome');
                        if (userWelcome) userWelcome.textContent = `${myName}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤! ğŸ°`;
                    }
                });
            } else {
                // ë¡œê·¸ì•„ì›ƒ ìƒíƒœë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                window.location.href = 'login.html';
            }
        });
    </script>
</body>
</html> 